{"version":3,"sources":["views/app-view.js"],"names":["TodoView","Backbone","View","extend","tagName","keypress .searchIpt","events","initialize","this","$el","$","fooList","searchBtnStatus","render","listenTo","foodLists","_","template","html","models","foodTemplate","edit","close","search","createOnEnter","e","self","input","val","food","which","ENTER_KEY","reset","ajax","nutUrl","done","result","Object","prototype","toString","call","indexOf","hits","myTodos","i","myTodo","title","fields","brandName","calories","get","set","push","alert","respond"],"mappings":"YAAA,IAAIA,UAAWC,SAASC,KAAKC,QAA7BC,QAAIJ,QAEFI,QAGEC,sBAAuB,gBADzBC,mBAAQ,UAMRC,WAAY,WADZC,KAAAC,IAAAC,EAAA,SACAH,KAAAA,QAAYG,EAAA,YACVF,KAAKC,MAAQD,KAAAE,EAAF,cACXF,KAAKG,iBAAY,EAEjBH,KAAKI,SAAAA,UAAkB,MAAvBJ,KAAAK,QACAL,KAAAM,SAAAC,UAAA,SAAAP,KAAAK,SAMFA,OAAQ,WAARA,GAAAA,GAAQG,EAAAC,SAAWP,EAAA,kBAAAQ,QAAAH,UAAAA,UAAAI,QAEjB,OADAX,MAAAG,QAAAO,KAAAE,GACIA,MAGLC,KA1BiC,aA8BjCC,MA9BiC,aAkCjCC,OAlCiC,WAqChCf,KAAKI,iBAAkB,EADzBW,KAAAA,iBAGCC,cAvCiC,SAAAC,GA0ChC,GAAIC,GAAOlB,KADdgB,EAAAA,EAAeG,MAAAC,MACRF,EAAO,2CAAXG,EAAA,gIAK2B,IAAzBH,EAAKd,iBAA4Ba,EAAEK,QAAUC,YAC7ChB,UAAAiB,SACA,IAAAjB,EAAAA,kBACAW,EAAIA,iBAAA,GAEHhB,EAAAuB,MACCA,IAAKC,IAAPC,KAGCA,SAAKC,GACJ,IAAkE,IAA9DC,OAAOC,UAAUC,SAASC,KAAKJ,GAAQK,QAAQ,WACjD,GAAIL,EAAOM,KAAM,CAEjB,IAAA,GADMC,MACDC,EAAIA,EAATA,EAAgBA,EAAIR,KAAOM,OAA3BE,IAAA,CAEE,GAAAC,GAAIA,GAAS7C,WACX8C,MAAAA,EAAOV,KAAOM,GAAPK,OAAeA,UACtBC,UAAAA,EAAWZ,KAAOM,GAAPK,OAAeA,WAC1BE,SAAAA,EAAUb,KAAOM,GAAPK,OAAeA,aAGvB,UAAJF,EAAIA,IAAOK,cACTL,EAAAA,IAAOM,YAAP,IAEFR,EAAAA,KAAQS,GAGVrC,UAAAA,KAAUqC,QAGVC,OAAM,qBAIRA,KAAAA,SAAAC,GA5BFD,MAAA","file":"app-view.js","sourcesContent":["var TodoView = Backbone.View.extend({\r\n\r\n  tagName: '#todo',\r\n\r\n  events: {\r\n    'keypress .searchIpt': 'createOnEnter',\r\n    'click .searchBtn': 'search'\r\n  },\r\n\r\n  // Called when the view is first created\r\n  initialize: function() {\r\n    this.$el = $('#todo');\r\n    this.fooList = $('#fooList');\r\n    this.input = this.$('.searchIpt');\r\n    this.searchBtnStatus = false;\r\n    // 监听collections有改变就render\r\n    this.listenTo(foodLists, 'add', this.render);\r\n    this.listenTo(foodLists, 'change', this.render);\r\n  },\r\n\r\n  // Re-render the titles of the todo item.\r\n  render: function() {\r\n    // 刷新食物列表\r\n    var foodTemplate = _.template( $('#food-template').html(), {foodLists: foodLists.models});\r\n    this.fooList.html(foodTemplate);\r\n    return this;\r\n  },\r\n\r\n  edit: function() {\r\n    // executed when todo label is double clicked\r\n  },\r\n\r\n  close: function() {\r\n    // executed when todo loses focus\r\n  },\r\n\r\n  search: function() {\r\n    this.searchBtnStatus = true;\r\n    this.createOnEnter();\r\n  },\r\n\r\n\tcreateOnEnter: function(e) {\r\n    var self = this;\r\n    var food = self.input.val();\r\n    var nutUrl = 'https://api.nutritionix.com/v1_1/search/' + food +'?fields=item_name%2Citem_id%2Cbrand_name%2Cnf_calories%2Cnf_total_fat'\r\n     + '&appId=fafaa50d&appKey=dd6e5d7563cfb23e902d053eca5c80a4';\r\n\r\n\t\tif (self.searchBtnStatus === true || e.which === ENTER_KEY) {\r\n      // 清除列表内容\r\n      foodLists.reset();\r\n      if (self.searchBtnStatus === true) {\r\n        self.searchBtnStatus = false;\r\n      }\r\n      $.ajax({\r\n        url: nutUrl,\r\n      })\r\n      .done(function(result) {\r\n        if (Object.prototype.toString.call(result).indexOf('Object') !== -1) {\r\n          if (result.hits) {\r\n            var myTodos = [];\r\n          for (var i = 0; i < result.hits.length; i++) {\r\n            // new 一个 model\r\n            var myTodo = new TodoView({\r\n              title: result.hits[i].fields.item_name,\r\n              brandName: result.hits[i].fields.brand_name,\r\n              calories: result.hits[i].fields.nf_calories\r\n            });\r\n            // 如果是USDA的不用显示USDA name\r\n            if (myTodo.get('brandName') === 'USDA') {\r\n              myTodo.set('brandName', '');\r\n            }\r\n            myTodos.push(myTodo);\r\n          }\r\n          // 添加到collections中\r\n          foodLists.push(myTodos);\r\n          }\r\n        } else {\r\n          alert('响应的结果数据类型不是一个对象');\r\n        }\r\n      })\r\n      .fail(function(respond) {\r\n        alert('响应失败')\r\n      });\r\n\t\t}\r\n\t}\r\n});\r\n"]}