{"version":3,"sources":["views/app-view.js"],"names":["AppView","Backbone","View","extend","el","events","initialize","this","foodListEle","$","render","length","foodsCol","each","food","TodoView","model","append","search","searchBtnStatus","createOnEnter","e","self","input","val","which","ENTER_KEY","html","spinner","spin","loadTarget","ajax","nutUrl","done","result","reset","Object","prototype","toString","call","indexOf","hits","newFoods","i","newFood","Food","title","fields","item_name","brandName","brand_name","calories","nf_calories","get","set","push","alert","respond"],"mappings":"YAAA,IAAIA,SAAUC,SAASC,KAAKC,QAA5BC,GAAIJ,QAGFK,QADAD,sBAFiC,gBAGjCC,mBAAQ,UAMRC,WAAY,WADZC,KAAAC,YAAAC,EAAA,aACAH,KAAAA,MAAYC,KAAAE,EAAA,cACVF,KAAKC,iBAAgB,GAMvBE,OAAQ,WAOJ,MAPJA,UAAQC,OAAA,IACNC,SAAAC,KAAA,SAAAC,GACIF,GAAAA,GAASD,GAATI,WAAqBC,MAAAF,GACvBF,MAAAA,YAAcK,OAASH,EAAMJ,SAAAN,KAC3BG,MACAA,KAAAC,YAAKA,QAEFA,MAGRU,OA1BgC,WA6B/BX,KAAKY,iBAAkB,EADzBD,KAAAA,iBAGCE,cA/BgC,SAAAC,GAkC/B,GAAIC,GAAOf,KADda,EAAAA,EAAeG,MAAAC,MACRF,EAAO,2CAAXR,EAAA,gIAK2B,IAAzBQ,EAAKH,iBAA4BE,EAAEI,QAAUC,aAApB,IAAzBJ,EAAKH,kBACLG,EAAIA,iBAAA,GAGJf,KAAAC,YAAAmB,KAAA,IAEAC,QAAAC,KAAAC,YACAF,EAAAA,MACEG,IAAKC,IAAPC,KAGCA,SAAKC,GAKJ,GAHAtB,SAASuB,QAETP,QAAQC,QAC0D,IAA9DO,OAAOC,UAAUC,SAASC,KAAKL,GAAQM,QAAQ,WACjD,GAAIN,EAAOO,KAAM,CAEf,IAAK,GADDC,MACKC,EAAI,EAAGA,EAAIT,EAAOO,KAAK9B,OAAQgC,IAAK,CAE3C,GAAIC,GAAU,GAAIC,OAChBC,MAAOZ,EAAOO,KAAKE,GAAGI,OAAOC,UAC7BC,UAAWf,EAAOO,KAAKE,GAAGI,OAAOG,WACjCC,SAAUjB,EAAOO,KAAKE,GAAGI,OAAOK,aAGD,UAA7BR,EAAQS,IAAI,cACdT,EAAQU,IAAI,YAAa,IAE3BZ,EAASa,KAAKX,GAGhBhC,SAAS2C,KAAKb,GACdpB,EAAKZ,cAGP8C,OAAM,qBAIRA,KAAAA,SAAAC,GAjCFD,MAAA","file":"app-view.js","sourcesContent":["var AppView = Backbone.View.extend({\r\n\r\n  el: '#todo',\r\n  events: {\r\n    'keypress .searchIpt': 'createOnEnter',\r\n    'click .searchBtn': 'search',\r\n  },\r\n\r\n  // Called when the view is first created\r\n  initialize: function() {\r\n    this.foodListEle = $('#foodList');\r\n    this.input = this.$('.searchIpt');\r\n    this.searchBtnStatus = false;\r\n  },\r\n\r\n  // Re-render the titles of the todo item.\r\n  render: function() {\r\n    // 刷新食物列表\r\n    if (foodsCol.length > 0) {\r\n      foodsCol.each(function(food) {\r\n        var view = new TodoView({model: food});\r\n        this.foodListEle.append(view.render().el);\r\n      }, this);\r\n      this.foodListEle.show();\r\n    }\r\n    return this;\r\n  },\r\n\r\n  search: function() {\r\n    this.searchBtnStatus = true;\r\n    this.createOnEnter();\r\n  },\r\n\r\n\tcreateOnEnter: function(e) {\r\n    var self = this;\r\n    var food = self.input.val();\r\n    var nutUrl = 'https://api.nutritionix.com/v1_1/search/' + food +'?fields=item_name%2Citem_id%2Cbrand_name%2Cnf_calories%2Cnf_total_fat'\r\n     + '&appId=fafaa50d&appKey=dd6e5d7563cfb23e902d053eca5c80a4';\r\n\r\n\t\tif (self.searchBtnStatus === true || e.which === ENTER_KEY) {\r\n      if (self.searchBtnStatus === true) {\r\n        self.searchBtnStatus = false;\r\n      }\r\n      // 清除原来内容\r\n      this.foodListEle.html('');\r\n      // 显示加载显示器\r\n      spinner.spin(loadTarget);\r\n      $.ajax({\r\n        url: nutUrl,\r\n      })\r\n      .done(function(result) {\r\n        // 清除collections内容\r\n        foodsCol.reset();\r\n        // 成功响应后，关闭加载显示器\r\n        spinner.spin();\r\n        if (Object.prototype.toString.call(result).indexOf('Object') !== -1) {\r\n          if (result.hits) {\r\n            var newFoods = [];\r\n            for (var i = 0; i < result.hits.length; i++) {\r\n              // new 一个 model\r\n              var newFood = new Food({\r\n                title: result.hits[i].fields.item_name,\r\n                brandName: result.hits[i].fields.brand_name,\r\n                calories: result.hits[i].fields.nf_calories\r\n              });\r\n              // 如果是USDA的不用显示USDA name\r\n              if (newFood.get('brandName') === 'USDA') {\r\n                newFood.set('brandName', '');\r\n              }\r\n              newFoods.push(newFood);\r\n            }\r\n            // 添加到collections中\r\n            foodsCol.push(newFoods);\r\n            self.render();\r\n          }\r\n        } else {\r\n          alert('响应的结果数据类型不是一个对象');\r\n        }\r\n      })\r\n      .fail(function(respond) {\r\n        alert('响应失败')\r\n      });\r\n\t\t}\r\n\t}\r\n});\r\n"]}